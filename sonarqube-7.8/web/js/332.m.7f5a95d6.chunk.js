(window.webpackJsonp=window.webpackJsonp||[]).push([[332],{1653:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return s});var a=n(363),c=n(884);function s(e){return a.createElement(c.a,Object.assign({setup:!1},e))}},410:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var a=n(363),c=n(358),s=n(13);function i(e){let t=e.children,n=e.date;return a.createElement(c.FormattedRelative,{value:Object(s.g)(n)},t)}},528:function(e,t,n){"use strict";n.d(t,"g",function(){return s}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return r}),n.d(t,"d",function(){return l}),n.d(t,"a",function(){return m}),n.d(t,"e",function(){return u}),n.d(t,"f",function(){return o}),n.d(t,"h",function(){return d});var a=n(4),c=n(382);function s(e){return Object(a.post)("/api/system/change_log_level",{level:e}).catch(c.a)}function i(){return Object(a.getJSON)("/api/system/info").catch(c.a)}function r(){return Object(a.getJSON)("/api/system/status")}function l(){return Object(a.getJSON)("/api/system/upgrades")}function m(){return Object(a.getJSON)("/api/system/db_migration_status")}function u(){return Object(a.postJSON)("/api/system/migrate_db")}function o(){return Object(a.post)("/api/system/restart").catch(c.a)}function d(){return Object(a.requestTryAndRepeatUntil)(r,{max:-1,slowThreshold:-15},e=>{return"UP"===e.status})}},615:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var a=n(363),c=n(358),s=n(13);const i={hour:"numeric",minute:"numeric"},r={hour:"numeric",minute:"numeric",second:"numeric"};function l(e){let t=e.children,n=e.date,l=e.long;return a.createElement(c.FormattedTime,Object.assign({value:Object(s.g)(n)},l?r:i),t)}},884:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var a=n(363),c=n(364),s=n(379),i=n.n(s),r=n(528),l=n(410),m=n(615),u=n(365),o=n(0),d=n(449),h=n(370),g=n(14);n(885);class p extends a.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={},this.fetchStatus=(()=>{(this.props.setup?this.fetchMigrationState():this.fetchSystemStatus()).catch(()=>{this.mounted&&this.setState({message:void 0,startedAt:void 0,state:void 0,status:"OFFLINE"})})}),this.fetchSystemStatus=(()=>Object(r.c)().then(e=>{let t=e.status;this.mounted&&(this.setState({status:t}),"STARTING"===t?(this.setState({wasStarting:!0}),this.scheduleRefresh()):"UP"===t?this.state.wasStarting&&this.loadPreviousPage():this.scheduleRefresh())})),this.fetchMigrationState=(()=>Object(r.a)().then(e=>{let t=e.message,n=e.startedAt,a=e.state;this.mounted&&(this.setState({message:t,startedAt:n,state:a}),"MIGRATION_SUCCEEDED"===a?this.loadPreviousPage():"NO_MIGRATION"!==a&&this.scheduleRefresh())})),this.scheduleRefresh=(()=>{this.interval=window.setTimeout(this.fetchStatus,5e3)}),this.loadPreviousPage=(()=>{setInterval(()=>{window.location.href=Object(h.A)(this.props.location)},2500)}),this.handleMigrateClick=(()=>{Object(r.e)().then(e=>{let t=e.message,n=e.startedAt,a=e.state;this.mounted&&this.setState({message:t,startedAt:n,state:a})},()=>{})})}componentDidMount(){this.mounted=!0,this.fetchStatus()}componentWillUnmount(){this.mounted=!1,this.interval&&window.clearInterval(this.interval)}render(){const e=this.state,t=e.state,n=e.status;return a.createElement(a.Fragment,null,a.createElement(i.a,{defaultTitle:Object(o.l)("maintenance.page")}),a.createElement("div",{className:"page-wrapper-simple",id:"bd"},a.createElement("div",{className:c("page-simple",{"panel-warning":"MIGRATION_REQUIRED"===t}),id:"nonav"},"OFFLINE"===n&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title text-danger"},a.createElement(d.a,{message:Object(o.l)("maintenance.is_offline")})),!Object(g.isSonarCloud)()&&a.createElement("p",{className:"maintenance-text"},Object(o.l)("maintenance.sonarqube_is_offline.text")),a.createElement("p",{className:"maintenance-text text-center"},a.createElement("a",{href:Object(h.b)()+"/"},Object(o.l)("maintenance.try_again")))),"UP"===n&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title"},a.createElement(d.a,{message:Object(o.l)("maintenance.is_up")})),a.createElement("p",{className:"maintenance-text text-center"},Object(o.l)("maintenance.all_systems_opetational")),a.createElement("p",{className:"maintenance-text text-center"},a.createElement("a",{href:Object(h.b)()+"/"},Object(o.l)("layout.home")))),"STARTING"===n&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title"},a.createElement(d.a,{message:Object(o.l)("maintenance.is_starting")})),a.createElement("p",{className:"maintenance-spinner"},a.createElement("i",{className:"spinner"}))),"DOWN"===n&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title text-danger"},a.createElement(d.a,{message:Object(o.l)("maintenance.is_down")})),a.createElement("p",{className:"maintenance-text"},Object(o.l)("maintenance.sonarqube_is_down.text")),a.createElement("p",{className:"maintenance-text text-center"},a.createElement("a",{href:Object(h.b)()+"/"},Object(o.l)("maintenance.try_again")))),("DB_MIGRATION_NEEDED"===n||"DB_MIGRATION_RUNNING"===n)&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title"},a.createElement(d.a,{message:Object(o.l)("maintenance.is_under_maintenance")})),!Object(g.isSonarCloud)()&&a.createElement(a.Fragment,null,a.createElement("p",{className:"maintenance-text",dangerouslySetInnerHTML:{__html:Object(o.l)("maintenance.sonarqube_is_under_maintenance.1")}}),a.createElement("p",{className:"maintenance-text",dangerouslySetInnerHTML:{__html:Object(o.l)("maintenance.sonarqube_is_under_maintenance.2")}}))),"NO_MIGRATION"===t&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title"},Object(o.l)("maintenance.database_is_up_to_date")),a.createElement("p",{className:"maintenance-text text-center"},a.createElement("a",{href:Object(h.b)()+"/"},Object(o.l)("layout.home")))),"MIGRATION_REQUIRED"===t&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title"},Object(o.l)("maintenance.upgrade_database")),a.createElement("p",{className:"maintenance-text"},Object(o.l)("maintenance.upgrade_database.1")),a.createElement("p",{className:"maintenance-text"},Object(o.l)("maintenance.upgrade_database.2")),a.createElement("p",{className:"maintenance-text"},Object(o.l)("maintenance.upgrade_database.3")),a.createElement("div",{className:"maintenance-spinner"},a.createElement(u.a,{id:"start-migration",onClick:this.handleMigrateClick},Object(o.l)("maintenance.upgrade")))),"NOT_SUPPORTED"===t&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title text-danger"},Object(o.l)("maintenance.migration_not_supported")),a.createElement("p",null,Object(o.l)("maintenance.migration_not_supported.text"))),"MIGRATION_RUNNING"===t&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title"},Object(o.l)("maintenance.database_migration")),this.state.message&&a.createElement("p",{className:"maintenance-text text-center"},this.state.message),this.state.startedAt&&a.createElement("p",{className:"maintenance-text text-center"},Object(o.l)("background_tasks.table.started")," ",a.createElement(l.a,{date:this.state.startedAt}),a.createElement("br",null),a.createElement("small",{className:"text-muted"},a.createElement(m.a,{date:this.state.startedAt,long:!0}))),a.createElement("p",{className:"maintenance-spinner"},a.createElement("i",{className:"spinner"}))),"MIGRATION_SUCCEEDED"===t&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title text-success"},Object(o.l)("maintenance.database_is_up_to_date")),a.createElement("p",{className:"maintenance-text text-center"},a.createElement("a",{href:Object(h.b)()+"/"},Object(o.l)("layout.home")))),"MIGRATION_FAILED"===t&&a.createElement(a.Fragment,null,a.createElement("h1",{className:"maintenance-title text-danger"},Object(o.l)("maintenance.upgrade_failed")),a.createElement("p",{className:"maintenance-text"},Object(o.l)("maintenance.upgrade_failed.text"))))))}}},885:function(e,t,n){var a=n(886);"string"==typeof a&&(a=[[e.i,a,""]]);var c={hmr:!0,transform:void 0,insertInto:void 0};n(367)(a,c);a.locals&&(e.exports=a.locals)},886:function(e,t,n){(e.exports=n(366)(!1)).push([e.i,".maintenance-title{margin-bottom:40px;line-height:1.5;font-size:24px;font-weight:300;text-align:center}.maintenance-text{margin-bottom:16px;line-height:1.5;font-size:16px;font-weight:300}.maintenance-spinner{margin-top:40px;text-align:center}",""])}}]);
//# sourceMappingURL=332.m.7f5a95d6.chunk.js.map